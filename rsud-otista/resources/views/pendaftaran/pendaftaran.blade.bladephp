<!DOCTYPE html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Pendaftaran</title>
        
        <link rel="stylesheet" href="{{ asset('style') }}/bower_components/bootstrap/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="{{ asset('style') }}/bower_components/select2/dist/css/select2.css">
        <link rel="stylesheet" href="{{ asset('css/bootstrap-chosen.css') }}">
        <link rel="stylesheet" href="{{ asset('style') }}/bower_components/font-awesome/css/font-awesome.min.css">
        <link rel="stylesheet" href="{{ asset('style') }}/bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker.css">
        <link rel="stylesheet" href="{{ asset('style') }}/bower_components/custom/custom.css">
        <style>
            body{background-image: url(images/lamaddukkeleng.jpg);background-repeat: no-repeat;background-size: cover;}
            header{height: 80px;background: rgba(255, 136, 13, 0.58);}
            header .logo{height: 100%;}
            header .logo img{height: 100%;}
            header .logo h1{display: inline-block;margin: 5px 0;color: #fff;}
            header .logo p{color: #fff;}
            .form{background: rgba(255, 255, 255, 0.82)}
            .colForm{box-shadow: 0 1px 3px #000 !important;}
            .container{margin-top: 50px}
            .form:first-child{padding-top:10px;}
        </style>
    </head>
<html lang="en">
	<body>
        <header class="text-center">
            <div class="logo">
                <h1>RSUD LAMADDUKKELENG</h1><br/>
                <p>Jl. Kartika Chandra Kirana No. 09 Sengkang, Kodepos 90914 Tlp. 0485 21785</p>
            </div>
        </header>
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-md-offset-3 form">
                    <div class="stepwizard">
                        <div class="stepwizard-row setup-panel">
                            <div class="stepwizard-step">
                                <a href="#step-1" type="button" class="btn btn-primary btn-circle">1</a>
                                <p>Pasien</p>
                            </div>
                            <div class="stepwizard-step">
                                <a href="#step-2" type="button" class="btn btn-default btn-circle disabled">2</a>
                                <p>Cara Bayar</p>
                            </div>
                            <div class="stepwizard-step">
                                <a href="#step-3" type="button" class="btn btn-default btn-circle disabled">3</a>
                                <p>Pendaftaran Online</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <form role="form" id="form" method="post" action="pendaftaran/store">
                {{ csrf_field() }}
                <div class="row setup-content" id="step-1">
                    <div class="col-xs-12 col-md-6 col-md-offset-3 form">
                        <div class="col-md-12 colForm">
                            <div class="formHeader">
                                <h4>DATA PASIEN</h4>
                                <p>Pendaftaran online untuk pasien yang sudah terdaftar</p>
                            </div>
                            <div class="cekPasien"></div>
                            <div class="form-group">
                                <label class="col-lg-5 control-label">No. RM</label>
                                <div class="col-lg-7">
                                    <input type="number" class="form-control" name="no_rm" placeholder="No. Rekam Medik" required="required">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-lg-5 control-label">Tgl. Lahir</label>
                                <div class="col-lg-7">
                                    <input type="text" class="form-control datepicker" name="tgl_lahir" id="tgl_lahir" placeholder="Tanggal Lahir" required="required">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-lg-12">
                                    <button class="btn btn-success nextBtn pull-right" type="button">Next</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row setup-content" id="step-2">
                    <div class="col-xs-12 col-md-6 col-md-offset-3 form">
                        <div class="col-md-12 colForm">
                            <div class="formHeader">
                                <h4>DATA PASIEN</h4>
                                <p>Silakan lengkapi data di bawah ini</p>
                            </div>
                            <div class="form-group">
                                <label for="label_nohp" class="col-lg-5 control-label">Nama</label>
                                <div class="col-lg-7">
                                    <input type="text" class="form-control" name="nama" value="" required="required" readonly="readonly">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="label_nohp" class="col-lg-5 control-label">Alamat</label>
                                <div class="col-lg-7">
                                    <input type="text" name="alamat" class="form-control" name="alamat" value="" required="required" readonly="readonly">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="selectCaraBayar" class="col-lg-5 control-label">Jenis Kelamin</label>
                                <div class="col-lg-7">
                                    {!! Form::select('kelamin', ['L' => 'Laki-laki', 'P' => 'Perempuan'], null, ['class' => 'form-control', 'readonly' => 'readonly']) !!}
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-lg-5 control-label">Tgl. Lahir</label>
                                <div class="col-lg-7">
                                    <input type="text" class="form-control" name="tgllahir" placeholder="Tanggal Lahir" readonly required="required">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="label_nohp" class="col-lg-5 control-label">No. Handphone</label>
                                <div class="col-lg-7">
                                    <input type="number" class="form-control" name="no_telp" value="" required="required">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="selectCaraBayar" class="col-lg-5 control-label">Cara Bayar</label>
                                <div class="col-lg-7">
                                    {!! Form::select('cara_bayar', $cara_bayar, null, ['class' => 'form-control select2', 'onChange' => 'embuh()']) !!}
                                </div>
                            </div>
                            <div class="form-group divJKN">
                                <label for="label_nopeserta" class="col-lg-5 control-label">No. Peserta</label>
                                <div class="col-lg-7">
                                    <input type="text" class="form-control no_rm" name="no_peserta" disabled="disabled" required="required">
                                </div>
                            </div>
                            <div class="form-group divJKN" id="noRuj">
                                <label for="label_norujukan" class="col-lg-5 control-label">No. Rujukan/ Tanggal SKD</label>
                                <div class="col-lg-7">
                                    <input type="text" class="form-control" name="no_rujukan" value="" id="label_norujukan">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-lg-12">
                                    <button class="btn btn-success nextBtn pull-right" type="button">Next</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row setup-content" id="step-3">
                    <div class="col-xs-12 col-md-6 col-md-offset-3 form">
                        <div class="col-md-12 colForm">	
                            <div class="formHeader">
                                <h4>DATA PENDAFTARAN ONLINE</h4>
                                <p>Silakan pilih tanggal periksa & lengkapi data pendaftaran</p>
                            </div>
                            <div class="form-group">
                                <label for="tgl_periksa" class="col-lg-3 control-label">Tgl. Periksa</label>
                                <div class="col-lg-9">
                                    <input type="text" class="form-control datepicker" id="periksa" name="tgl_periksa" placeholder="Tgl. Periksa" required="required">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="selectPoli" class="col-lg-3 control-label">Poliklinik</label>
                                <div class="col-lg-9">
                                    <select id="selectPoli" class="form-control" name="kode_poli" required="required">
                                    @foreach ($poli as $p)
                                        <option value="{{ $p->id }}">{{ $p->nama }}</option>
                                    @endforeach
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="selectDokter" class="col-lg-3 control-label">Dokter</label>
                                <div class="col-lg-9">
                                    <select id="selectDokter" class="form-control" name="kode_dokter" required="required">
                                    @foreach ($dokter as $d)
                                        <option value="{{ $d->id }}">{{ $d->nama }}</option>
                                    @endforeach
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-lg-12">
                                    <button class="btn btn-success pull-right" type="submit">Daftar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </body>
    <script src="{{ asset('style') }}/bower_components/jquery/dist/jquery.min.js"></script>
    <script src="{{ asset('style') }}/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="{{ asset('style') }}/bower_components/jquery/dist/jquery.tooltipster.min.js"></script>
    <script src="{{ asset('style') }}/bower_components/jquery/dist/jquery.validate.min.js"></script>
    <script src="{{ asset('style') }}/bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
    <script type="text/javascript">
        function embuh(){
            var cb = $('select[name="cara_bayar"]').val();
            if(cb != 1){
                $('#noRuj').hide();
            }else{
                $('#noRuj').show();
            }
        }
        $(document).ready(function () {
            $("#tgl_lahir").datepicker({
                format: "yyyy-mm-dd",
                autoclose: true
            });
            $("#periksa").datepicker({
                startDate: "dateToday",
                format: "dd-mm-yyyy",
                autoclose: true
            });

            $('input, select').tooltipster({
                trigger: 'custom',
                onlyOne: false,
                position: 'right',
                theme: 'tooltipster-light'
            });

            $("#form").validate({
                errorPlacement: function (error, element) {
                    var lastError = $(element).data('lastError'),
                        newError = $(error).text();

                    $(element).data('lastError', newError);

                    if(newError !== '' && newError !== lastError){
                        $(element).tooltipster('content', newError);
                        $(element).tooltipster('show');
                    }
                },
                success: function (label, element) {
                    $(element).tooltipster('hide');
                }
            });

            var navListItems = $('div.setup-panel div a'),
                    allWells = $('.setup-content'),
                    allNextBtn = $('.nextBtn');
                    allWells.hide();

            navListItems.click(function (e) {
                e.preventDefault();
                var $target = $($(this).attr('href')),
                    $item = $(this);

                if (!$item.hasClass('disabled')) {
                    navListItems.removeClass('btn-primary').addClass('btn-default');
                    $item.addClass('btn-primary');
                    $('input, select').tooltipster("hide");
                    allWells.hide();
                    $target.show();
                    $target.find('input:eq(0)').focus();
                }
            });

            allNextBtn.click(function(){
                var curStep = $(this).closest(".setup-content"),
                    curStepBtn = curStep.attr("id"),
                    nextStepWizard = $('div.setup-panel div a[href="#' + curStepBtn + '"]').parent().next().children("a"),
                    curInputs = curStep.find("input"),
                    isValid = true,
                    loop = 0;

                for(var i=0; i<curInputs.length; i++){
                    loop = i;
                    if (!$(curInputs[i]).valid()){
                        isValid = false;
                    }
                }

                if (isValid){
                    if(loop == 1){
                        var no_rm = $("input[name='no_rm']").val(),
                            tgl_lahir = $("input[name='tgl_lahir']").val(),
                            _token  = $("input[name='_token']").val();
                        $.get('/pendaftaran/checkNoRm/'+no_rm+'/'+tgl_lahir, function(data){
                            var pasien = JSON.parse(data);
                            if(pasien.status == 'ada'){
                                $("input[name='no_telp']").val(pasien.result.nohp);
                                $(".no_rm").val(pasien.result.no_rm);
                                $("input[name='nama']").val(pasien.result.nama.split(",")[0]);
                                $("input[name='tgllahir']").val(pasien.result.tgllahir);
                                $("input[name='alamat']").val(pasien.result.alamat);
                                $("select[name='kelamin']").val(pasien.result.kelamin).trigger('change');

                                nextStepWizard.removeClass('disabled').trigger('click');
                            }else{
                                $('.cekPasien').html('<div class="alert alert-danger text-center">Data Pasien tidak ditemukan</div>');
                            }
                        });
                    }else if(loop == 2){
                        $("#cellNoHp").text($("input[name='no_telp']").val());
                        $("#cellNoRujukan").text($("input[name='no_rujukan']").val());

                        nextStepWizard.removeClass('disabled').trigger('click');
                    }else{
                        nextStepWizard.removeClass('disabled').trigger('click');
                    }
                }
            });

            $('div.setup-panel div a.btn-primary').trigger('click');
        });
    </script>
</html>