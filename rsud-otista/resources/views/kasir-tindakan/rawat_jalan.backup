{!! Form::open(['method' => 'POST', 'url' => 'kasir/rawatjalan', 'class'=>'form-horizontal']) !!}
<div class="row">
    <div class="col-md-6">
        <div class="form-group{{ $errors->has('tanggal') ? ' has-error' : '' }}">
            {!! Form::label('tanggal', 'Tanggal', ['class' => 'col-sm-3 control-label']) !!}
            <div class="col-sm-9">
                {!! Form::text('tanggal', null, ['class' => 'form-control datepicker','autocomplete'=>'off']) !!}
                <small class="text-danger">{{ $errors->first('tanggal') }}</small>
            </div>

        </div>
        <div class="form-group{{ $errors->has('lunas') ? ' has-error' : '' }}">
            {!! Form::label('lunas', 'Lunas / Blm', ['class' => 'col-sm-3 control-label']) !!}
            <div class="col-sm-9">
                {!! Form::select('ket_lunas', ['' => '[Semua]', 'N'=> 'Belum Lunas', 'Y'=>'Lunas', 'P'=>'Piutang'], null, ['class' => 'form-control select2', 'style'=>'width: 100%']) !!}
                <small class="text-danger">{{ $errors->first('Lunas/Blm') }}</small>
            </div>
        </div>

    </div>
    <div class="col-md-6">
        <div class="form-group{{ $errors->has('carabayar') ? ' has-error' : '' }}">
            {!! Form::label('carabayar', 'Cara Bayar', ['class' => 'col-sm-3 control-label']) !!}
            <div class="col-sm-9">
                <select class="form-control select2" style="width: 100%" name="carabayar">
                  @if (!empty($_POST['carabayar']) && $_POST['carabayar'] == 1)
                    <option value="">[Semua]</option>
                    <option value="1" selected>JKN</option>
                    <option value="2">Umum</option>
                  @elseif (!empty($_POST['carabayar']) && $_POST['carabayar'] == 2)
                    <option value="">[Semua]</option>
                    <option value="1">JKN</option>
                    <option value="2" selected>Umum</option>
                  @else 
                    <option value="">[Semua]</option>
                     {{-- <option {{$_POST['carabayar'] == '1' ? 'selected' : ''}} value="1">JKN</option>
                      <option {{$_POST['carabayar'] == '2' ? 'selected' : ''}} value="2">Umum</option>  --}}
                      {{-- <option value="1">JKN</option>
                      <option value="2" selected>Umum</option> --}}
                   @foreach($bayar as $b)
                    <option value="{{ $b->id }}">{{ $b->carabayar }}</option>
                    @endforeach
                   @endif 

                </select>
                <small class="text-danger">{{ $errors->first('carabayar') }}</small>
            </div>
        </div>
        <div class="form-group{{ $errors->has('tipe_jkn') ? ' has-error' : '' }}">
            {!! Form::label('tipe_jkn', 'Tipe JKN', ['class' => 'col-sm-3 control-label']) !!}
            <div class="col-sm-9">
                <select class="form-control select2" style="width: 100%" name="tipe_jkn">
                  @if (!empty($_POST['tipe_jkn']) && $_POST['tipe_jkn'] == 'PBI')
                    <option value="">[Semua]</option>
                    <option value="PBI" selected>PBI</option>
                    <option value="NON PBI">NON PBI</option>
                  @elseif (!empty($_POST['tipe_jkn']) && $_POST['tipe_jkn'] == 'NON PBI')
                    <option value="">[Semua]</option>
                    <option value="PBI">PBI</option>
                    <option value="NON PBI" selected>NON PBI</option>
                  @else
                    <option value="">[Semua]</option>
                    <option value="PBI">PBI</option>
                    <option value="NON PBI">NON PBI</option>
                  @endif

                </select>
                <small class="text-danger">{{ $errors->first('tipe_jkn') }}</small>
            </div>
        </div>
        <div class="form-group">
            <div class="col-md-9 col-md-offset-3">
                <button type="submit" class="btn btn-primary btn-flat">
                    Lanjut
                </button>
            </div>
        </div>

    </div>
</div>
{!! Form::close() !!}
<hr>

<div class='table-responsive'>
  <table class='table table-striped table-bordered table-hover table-condensed' id='data'>
    <thead>
      <tr>
        <th>No</th>
        <th>Nama Pasien</th>
        <th>No. RM</th>
        <th>Dokter</th>
        <th>Klinik</th>
        <th>Cara Bayar</th>
        <th>Tanggal</th>
        <th>Total Tagihan</th>
        <th>Status</th>
        <th>Bayar</th>
        <th>Piutang</th>
      </tr>
    </thead>
    <tbody>
      @isset($today)
        @foreach ($today as $key => $d)
          {{-- @if (total_tagihan($d->id) > 0) --}}
            <tr>
              <td>{{ $no++ }}</td>
              <td>{{ $d->pasien->nama }}</td>
              <td>{{ $d->pasien->no_rm }}</td>
              <td>{{ baca_dokter($d->dokter_id) }}</td>
              <td>{{ !empty($d->poli_id) ? $d->poli->nama : '' }}</td>
              <td>{{ baca_carabayar($d->bayar) }} {{ (!empty($d->tipe_jkn) && $d->bayar == 1) ? ' - '.$d->tipe_jkn : '' }}</td>
              <td>{{ $d->created_at->format('d-m-Y') }}</td>
              @php
                $racik   = total_tagihan_racikan($d->id);
                $tagihan = total_tagihan($d->id);
              @endphp
              <td class="text-right">{{ number_format($tagihan+$racik) }}</td>
              {{-- <td class="text-right">{{ number_format(total_tagihan($d->id)) }}</td> --}}
              {{-- <td class="text-center">{!!number_format(total_tagihan($d->id)) == 0 ? '<i class="fa fa-check" style="color:green;" aria-hidden="true"></i>' : ''!!}</td> --}}
              <td class="text-center">@if ($d->lunas == 'Y') Lunas @else Belum Lunas @endif</td>
              <td>
                @if ($d->lunas == 'Y')
                  <i class="fa fa-check"> </i>
                @else
                  <a href="{{ url('kasir/rawatjalan/bayar/'. $d->id.'/'.$d->pasien_id) }}" class="btn btn-sm btn-info btn-flat"><i class="fa fa-credit-card"></i></a>
                 @endif
              </td>
              <td>
                @if ($d->bayar <> 1)
                  @if ($d->lunas == 'P')
                    Piutang
                  @else
                    <a href="{{ url('kasir/piutang/'.$d->id) }}" onclick="return confirm('Yakin akan di masukkan piutang?')" class="btn btn-sm btn-warning btn-flat"><i class="fa fa-dollar"></i></a>
                  @endif
                @endif
              </td>
            </tr>
          {{-- @endif --}}
        @endforeach
      @endisset
      @isset($byRM)
        @foreach ($byRM as $key => $d)
          <tr>
            <td>{{ $no++ }}</td>
            <td>{{ $d->nama }}</td>
            <td>{{ $d->no_rm }}</td>
            <td>{{ $d->reg_id }}</td>
            <td>{{ baca_dokter($d->dokter_id) }}</td>
            <td>{{ baca_poli($d->poli_id) }}</td>
            <td>{{ baca_carabayar($d->bayar) }}</td>
            <td>{{ number_format(total_tagihan($d->id)) }}</td>
            <td>
              <a href="{{ url('kasir/rawatjalan/bayar/'. $d->regid.'/'.$d->pasienid) }}" class="btn btn-sm btn-info btn-flat"><i class="fa fa-credit-card"></i></a>
            </td>
          </tr>
        @endforeach
      @endisset

    </tbody>
  </table>
</div>

@section('script')
  <script type="text/javascript">
    $('.select2').select2()
    $(document).ready(function() {
      if($('select[name="carabayar"]').val() == 1) {
        $('select[name="tipe_jkn"]').removeAttr('disabled');
      } else {
        $('select[name="tipe_jkn"]').attr('disabled', true);
      }

      $('select[name="carabayar"]').on('change', function () {
        if ($(this).val() == 1) {
          $('select[name="tipe_jkn"]').removeAttr('disabled');
        } else {
          $('select[name="tipe_jkn"]').attr('disabled', true);
        }
      });
    });

  </script>
@endsection
